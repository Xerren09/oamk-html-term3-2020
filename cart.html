<!DOCTYPE html>
<html>
    <head>
        <title>GPU Store</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="cart.css" />
        <link rel="stylesheet" href="fontawesome-free-5.15.1-web/css/all.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400&display=swap" rel="stylesheet">
    </head>
    <body>
        <!-- Page headers start here -->
        <div>
            <div id="HeaderContainer">
                <div id="HeaderBar">
                    <div class="Group">
                        <div id="DropdownSidebar">
                            <p> <i class="fa fa-bars"></i> </p>
                        </div>
                        <div id="Title">
                            <p>
                            <h1 style="color: #ededf0;"><b>Generic GPU Store</b></h1>
                            </p>
                        </div>
                    </div>
                    <div class="Group">
                        <div id="Account">
                            <a id="User_Login" href="error.html"> Log in </a>
                            <span style="color: #5f6062">or</span>
                            <a id="Create_Account" href="error.html"> Create an account </a>
                        </div>
                        <div id="Cart">
                            <a id="CartLink" href="cart.html"> <i class="fa fa-shopping-cart"></i> Cart: 0</a>
                        </div>
                        <div id="SearchBar">
                            <form action="error.html">
                                <button id="SearchButton" type="submit"> <i class="fa fa-search"></i> </button>
                                <input type="text" id="SearchField" placeholder="Search...">
                            </form>
                        </div>
                    </div>
                </div>
                <div id="MenuBar">
                    <button id="Btn_Left" title="Home" onclick="window.location.href='index.html'"> <b>Home</b> </button>
                    <button title="Games and media" onclick="window.location.href='error.html'"> <b>Games and Media</b> </button>
                    <button title="Cooling" onclick="window.location.href='error.html'"> <b>Cooling</b> </button>
                    <button title="Accessories" onclick="window.location.href='error.html'"> <b>Accessories</b> </button>
                    <button id="Btn_Right" title="Spare parts" onclick="window.location.href='error.html'"> <b>Spare Parts</b>
                    </button>
                </div>
            </div>
            
            <!-- Page content starts here -->
            
            <div id="Content">
            
                <div id="rectangle">
                    <div id="CartTitle">
                        <h1>CART</h1>
                    </div>
                    <div id="price_w">
                        <h2>Price</h2>
                    </div>

                    <div id="ItemList">
                        <!-- Cart items come here -->
                    </div>

                    <div style="margin-left: 30px; margin-right: 30px;">
                        <hr style="border: 2px solid #5f6062;">
                    </div>
                    <div id="ItemSum">
                        <h3 id="sumPrice" >TOTAL: 0 €</h3>
                    </div>
                    <div id="CheckoutControl">
                        <div id="DiscountControl">
                            <h2>Discount code: </h2>
                            <input type="text" name="" id="" placeholder="Enter code here...">
                            <button><b>UPDATE</b></button>
                        </div>
                        <div id="CheckoutButton">
                            <button> <b>CHECKOUT</b> </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page footer starts here -->

        <div id="Footer">
            <a href="https://www.freepik.com/vectors/background">Background vector created by starline - www.freepik.com</a>
        </div>

        <script>
            const _data = [
                    {
                        name: 'AMD Radeon 5700 XT',
                        price: '459',
                        image: 'resources/Images/251223-b324043_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'ASUS GeForce RTX 3070 8GB DUAL',
                        price: '599',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'MSI GeForce RTX 3070 Ventus 3X OC',
                        price: '619',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'ASUS GeForce RTX 3070 8GB GDDR6 DUAL OC',
                        price: '619',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'GeForce RTX3070 GamingPro',
                        price: '639',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'ASUS TUF GAMING GeForce RTX™ 3070 OC Edition 8GB GDDR6',
                        price: '669',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'EVGA GeForce RTX 3070 XC3 BLACK',
                        price: '619',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'ASUS ROG STRIX RTX3090 O24G GAMING',
                        price: '1889',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    },

                    {
                        name: 'ASUS GeForce RTX 3070 8GB GDDR6 ROG STRIX GAMING',
                        price: '719',
                        image: 'resources/Images/302003-b303045_300x300.jpg',
                        description: [
                            ''
                        ]
                    }
                ];

            var _cart = [];

            populateCartList();

            function populateCartList() {
                _cart.length = 0;
                _cart = JSON.parse(sessionStorage.getItem("_cart"));

                if (!_cart.length) {
                    generateCartItem(0, "NoItem", "Your cart is empty. Products will show up here after you added them.", "0");
                }
                else {
                    for (let i = 0; i < _cart.length; i++) {
                        generateCartItem(i, _data[parseInt(_cart[i])].image, _data[parseInt(_cart[i])].name, _data[parseInt(_cart[i])].price);
                    }
                }
                updatePriceNCart();
            }

            function updatePriceNCart()
            {
                let totalPrice = 0;
                for (let i = 0; i < _cart.length; i++) {
                    totalPrice += parseInt(_data[parseInt(_cart[i])].price);
                }
                document.getElementById('sumPrice').textContent = "TOTAL: " + totalPrice + " €";
                let cartCount = document.getElementById("CartLink");
                cartCount.textContent = " Cart: ";
                if (_cart.length <= 0) {
                    cartCount.textContent += ("0");
                }
                else{
                    cartCount.textContent += (_cart.length);
                }
            }

            function removeFromCart(removeID){ 
                _cart.splice(removeID, 1);
                sessionStorage.setItem("_cart", JSON.stringify(_cart));
                document.getElementById(removeID).remove();
                //
                let _cartElementList = document.getElementsByClassName("ListItem");
                for (let i = removeID; i < _cartElementList.length; i++)
                {
                    let _newid = parseInt(_cartElementList[i].id) - 1;
                    _cartElementList[i].id = _newid;
                    _cartElementList[i].getElementsByClassName("RemoveBtn")[0].onclick = function () { removeFromCart(_newid) };
                }
                //
                if (_cart.length <= 0) {
                    generateCartItem(0, "NoItem", "Your cart is empty. Products will show up here after you added them.", "0");
                }
                updatePriceNCart();
            }

            function generateCartItem(_itemID, _imagePath, _itemName, _itemPrice) {

                let cartItem = document.createElement('div');
                cartItem.classList.add('ListItem');
                cartItem.id = _itemID;

                let itemDivider = document.createElement('hr');

                let itemInfo = document.createElement('div');
                itemInfo.classList.add('ItemInfo');

                let itemControl = document.createElement('div');
                itemControl.classList.add('ItemControl');

                cartItem.append(itemDivider);
                cartItem.append(itemInfo);
                itemInfo.append(itemControl);

                let titleHeading = document.createElement('h2');

                if (_imagePath != "NoItem") {
                    let image = document.createElement('img');
                    image.classList.add('ItemImg');
                    image.src = _imagePath;
                    itemControl.append(image);

                    let removeButton = document.createElement('button');
                    removeButton.classList.add('RemoveBtn');
                    removeButton.append(document.createTextNode("Remove"));
                    removeButton.onclick = function () { removeFromCart(parseInt(_itemID)) };

                    let itemPrice = document.createElement('div');

                    let titleHeading2 = document.createElement('h2');
                    titleHeading2.append(document.createTextNode(_itemPrice + "€"));

                    let titleLink = document.createElement('a');
                    titleLink.classList.add('ItemTitle');
                    titleLink.href = "productpage.html";
                    titleLink.append(document.createTextNode(_itemName));

                    itemControl.append(titleHeading);
                    titleHeading.append(titleLink);
                    itemControl.append(removeButton);
                    itemInfo.append(itemPrice);
                    titleHeading.append(titleLink);
                    itemPrice.append(titleHeading2);
                }
                else
                {
                    titleHeading.append(document.createTextNode(_itemName));
                    itemControl.append(titleHeading);
                }                
                
                document.getElementById('ItemList').append(cartItem);
            }
        </script>

    </body>
</html>